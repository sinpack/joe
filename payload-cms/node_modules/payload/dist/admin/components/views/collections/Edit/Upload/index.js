"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    Upload: function() {
        return Upload;
    },
    UploadActions: function() {
        return UploadActions;
    },
    editDrawerSlug: function() {
        return editDrawerSlug;
    },
    sizePreviewSlug: function() {
        return sizePreviewSlug;
    }
});
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _reacttoastify = require("react-toastify");
const _isImage = /*#__PURE__*/ _interop_require_default(require("../../../../../../uploads/isImage"));
const _Button = /*#__PURE__*/ _interop_require_default(require("../../../../elements/Button"));
const _Drawer = require("../../../../elements/Drawer");
const _Dropzone = require("../../../../elements/Dropzone");
const _EditUpload = require("../../../../elements/EditUpload");
const _FileDetails = /*#__PURE__*/ _interop_require_default(require("../../../../elements/FileDetails"));
const _PreviewSizes = /*#__PURE__*/ _interop_require_default(require("../../../../elements/PreviewSizes"));
const _Thumbnail = /*#__PURE__*/ _interop_require_default(require("../../../../elements/Thumbnail"));
const _Error = /*#__PURE__*/ _interop_require_default(require("../../../../forms/Error"));
const _reduceFieldsToValues = /*#__PURE__*/ _interop_require_default(require("../../../../forms/Form/reduceFieldsToValues"));
const _shared = require("../../../../forms/field-types/shared");
const _useField = /*#__PURE__*/ _interop_require_default(require("../../../../forms/useField"));
const _DocumentInfo = require("../../../../utilities/DocumentInfo");
const _UploadEdits = require("../../../../utilities/UploadEdits");
require("./index.scss");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const baseClass = 'file-field';
const editDrawerSlug = 'edit-upload';
const sizePreviewSlug = 'preview-sizes';
const validate = (value)=>{
    if (!value && value !== undefined) {
        return 'A file is required.';
    }
    return true;
};
const UploadActions = ({ canEdit, showSizePreviews })=>{
    const { t } = (0, _reacti18next.useTranslation)('upload');
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__file-mutation`
    }, showSizePreviews && /*#__PURE__*/ _react.default.createElement(_Drawer.DrawerToggler, {
        className: `${baseClass}__previewSizes`,
        slug: sizePreviewSlug
    }, t('upload:previewSizes')), canEdit && /*#__PURE__*/ _react.default.createElement(_Drawer.DrawerToggler, {
        className: `${baseClass}__edit`,
        slug: editDrawerSlug
    }, t('upload:editImage')));
};
const Upload = (props)=>{
    const { collection, internalState, onChange } = props;
    const [replacingFile, setReplacingFile] = (0, _react.useState)(false);
    const [fileSrc, setFileSrc] = (0, _react.useState)(null);
    const { t } = (0, _reacti18next.useTranslation)([
        'upload',
        'general'
    ]);
    const { resetUploadEdits } = (0, _UploadEdits.useUploadEdits)();
    const [doc, setDoc] = (0, _react.useState)((0, _reduceFieldsToValues.default)(internalState || {}, true));
    const { docPermissions } = (0, _DocumentInfo.useDocumentInfo)();
    const { errorMessage, setValue, showError, value } = (0, _useField.default)({
        path: 'file',
        validate
    });
    const [showUrlInput, setShowUrlInput] = (0, _react.useState)(false);
    const [fileUrl, setFileUrl] = (0, _react.useState)('');
    const cursorPositionRef = (0, _react.useRef)(null);
    const urlInputRef = (0, _react.useRef)(null);
    const handleFileChange = (0, _react.useCallback)((newFile)=>{
        if (newFile instanceof File) {
            const fileReader = new FileReader();
            fileReader.onload = (e)=>{
                const imgSrc = e.target?.result;
                if (typeof imgSrc === 'string') {
                    setFileSrc(imgSrc);
                }
            };
            fileReader.readAsDataURL(newFile);
        }
        setValue(newFile);
        setShowUrlInput(false);
        if (typeof onChange === 'function') {
            onChange(newFile);
        }
    }, [
        onChange,
        setValue
    ]);
    const handleFileNameChange = (e)=>{
        const updatedFileName = e.target.value;
        const cursorPosition = e.target.selectionStart;
        cursorPositionRef.current = cursorPosition;
        if (value) {
            const fileValue = value;
            // Creating a new File object with updated properties
            const newFile = new File([
                fileValue
            ], updatedFileName, {
                type: fileValue.type
            });
            handleFileChange(newFile);
        }
    };
    (0, _react.useEffect)(()=>{
        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion
        const inputElement = document.querySelector(`.${baseClass}__filename`);
        if (inputElement && cursorPositionRef.current !== null) {
            inputElement.setSelectionRange(cursorPositionRef.current, cursorPositionRef.current);
        }
    }, [
        value
    ]);
    const handleFileSelection = _react.default.useCallback((files)=>{
        const fileToUpload = files?.[0];
        handleFileChange(fileToUpload);
    }, [
        handleFileChange
    ]);
    const handleFileRemoval = (0, _react.useCallback)(()=>{
        setReplacingFile(true);
        handleFileChange(null);
        setFileSrc('');
        setFileUrl('');
        setDoc({});
        resetUploadEdits();
        setShowUrlInput(false);
    }, [
        handleFileChange,
        resetUploadEdits
    ]);
    const handlePasteUrlClick = ()=>{
        setShowUrlInput((prev)=>!prev);
    };
    const handleUrlSubmit = async ()=>{
        if (fileUrl) {
            try {
                const response = await fetch(fileUrl);
                const data = await response.blob();
                // Extract the file name from the URL
                const fileName = fileUrl.split('/').pop();
                // Create a new File object from the Blob data
                const file = new File([
                    data
                ], fileName, {
                    type: data.type
                });
                handleFileChange(file);
            } catch (e) {
                _reacttoastify.toast.error(e.message);
            }
        }
    };
    (0, _react.useEffect)(()=>{
        setDoc((0, _reduceFieldsToValues.default)(internalState || {}, true));
        setReplacingFile(false);
    }, [
        internalState
    ]);
    (0, _react.useEffect)(()=>{
        if (showUrlInput && urlInputRef.current) {
            urlInputRef.current.focus() // Focus on the remote-url input field when showUrlInput is true
            ;
        }
    }, [
        showUrlInput
    ]);
    const canRemoveUpload = docPermissions?.update?.permission && 'delete' in docPermissions && docPermissions?.delete?.permission;
    const hasImageSizes = collection?.upload?.imageSizes?.length > 0;
    const hasResizeOptions = Boolean(collection?.upload?.resizeOptions);
    // Explicitly check if set to true, default is undefined
    const focalPointEnabled = collection?.upload?.focalPoint === true;
    const { collection: { upload: { crop: showCrop = true, focalPoint = true } } = {} } = props;
    const showFocalPoint = focalPoint && (hasImageSizes || hasResizeOptions || focalPointEnabled);
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: [
            _shared.fieldBaseClass,
            baseClass
        ].filter(Boolean).join(' ')
    }, /*#__PURE__*/ _react.default.createElement(_Error.default, {
        message: errorMessage,
        showError: showError
    }), doc.filename && !replacingFile && /*#__PURE__*/ _react.default.createElement(_FileDetails.default, {
        canEdit: showCrop || showFocalPoint,
        collection: collection,
        doc: doc,
        handleRemove: canRemoveUpload ? handleFileRemoval : undefined,
        hasImageSizes: hasImageSizes,
        imageCacheTag: doc.updatedAt
    }), (!doc.filename || replacingFile) && /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__upload`
    }, !value && !showUrlInput && /*#__PURE__*/ _react.default.createElement(_Dropzone.Dropzone, {
        className: `${baseClass}__dropzone`,
        mimeTypes: collection?.upload?.mimeTypes,
        onChange: handleFileSelection,
        onPasteUrlClick: handlePasteUrlClick
    }), showUrlInput && /*#__PURE__*/ _react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__remote-file-wrap`
    }, /*#__PURE__*/ _react.default.createElement("input", {
        className: `${baseClass}__remote-file`,
        onChange: (e)=>{
            setFileUrl(e.target.value);
        },
        ref: urlInputRef,
        type: "text",
        value: fileUrl
    }), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__add-file-wrap`
    }, /*#__PURE__*/ _react.default.createElement("button", {
        className: `${baseClass}__add-file`,
        onClick: handleUrlSubmit,
        type: "button"
    }, t('upload:addImage')))), /*#__PURE__*/ _react.default.createElement(_Button.default, {
        buttonStyle: "icon-label",
        className: `${baseClass}__remove`,
        icon: "x",
        iconStyle: "with-border",
        onClick: handleFileRemoval,
        round: true,
        tooltip: t('general:cancel')
    })), value && /*#__PURE__*/ _react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__thumbnail-wrap`
    }, /*#__PURE__*/ _react.default.createElement(_Thumbnail.default, {
        fileSrc: (0, _isImage.default)(value.type) ? fileSrc : null
    })), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__file-adjustments`
    }, /*#__PURE__*/ _react.default.createElement("input", {
        className: `${baseClass}__filename`,
        onChange: handleFileNameChange,
        type: "text",
        value: value.name
    }), (0, _isImage.default)(value.type) && value.type !== 'image/svg+xml' && /*#__PURE__*/ _react.default.createElement(UploadActions, {
        canEdit: showCrop || showFocalPoint,
        showSizePreviews: hasImageSizes && doc.filename && !replacingFile
    })), /*#__PURE__*/ _react.default.createElement(_Button.default, {
        buttonStyle: "icon-label",
        className: `${baseClass}__remove`,
        icon: "x",
        iconStyle: "with-border",
        onClick: handleFileRemoval,
        round: true,
        tooltip: t('general:cancel')
    }))), (value || doc.filename) && /*#__PURE__*/ _react.default.createElement(_Drawer.Drawer, {
        header: null,
        slug: editDrawerSlug
    }, /*#__PURE__*/ _react.default.createElement(_EditUpload.EditUpload, {
        doc: doc || undefined,
        fileName: value?.name || doc?.filename,
        fileSrc: doc?.url || fileSrc,
        imageCacheTag: doc.updatedAt,
        showCrop: showCrop,
        showFocalPoint: showFocalPoint
    })), doc && hasImageSizes && /*#__PURE__*/ _react.default.createElement(_Drawer.Drawer, {
        className: `${baseClass}__previewDrawer`,
        hoverTitle: true,
        slug: sizePreviewSlug,
        title: t('upload:sizesFor', {
            label: doc?.filename
        })
    }, /*#__PURE__*/ _react.default.createElement(_PreviewSizes.default, {
        collection: collection,
        doc: doc,
        imageCacheTag: doc.updatedAt
    })));
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL3ZpZXdzL2NvbGxlY3Rpb25zL0VkaXQvVXBsb2FkL2luZGV4LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCwgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgdXNlVHJhbnNsYXRpb24gfSBmcm9tICdyZWFjdC1pMThuZXh0J1xuaW1wb3J0IHsgdG9hc3QgfSBmcm9tICdyZWFjdC10b2FzdGlmeSdcblxuaW1wb3J0IHR5cGUgeyBQcm9wcyB9IGZyb20gJy4vdHlwZXMnXG5cbmltcG9ydCBpc0ltYWdlIGZyb20gJy4uLy4uLy4uLy4uLy4uLy4uL3VwbG9hZHMvaXNJbWFnZSdcbmltcG9ydCBCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vZWxlbWVudHMvQnV0dG9uJ1xuaW1wb3J0IHsgRHJhd2VyLCBEcmF3ZXJUb2dnbGVyIH0gZnJvbSAnLi4vLi4vLi4vLi4vZWxlbWVudHMvRHJhd2VyJ1xuaW1wb3J0IHsgRHJvcHpvbmUgfSBmcm9tICcuLi8uLi8uLi8uLi9lbGVtZW50cy9Ecm9wem9uZSdcbmltcG9ydCB7IEVkaXRVcGxvYWQgfSBmcm9tICcuLi8uLi8uLi8uLi9lbGVtZW50cy9FZGl0VXBsb2FkJ1xuaW1wb3J0IEZpbGVEZXRhaWxzIGZyb20gJy4uLy4uLy4uLy4uL2VsZW1lbnRzL0ZpbGVEZXRhaWxzJ1xuaW1wb3J0IFByZXZpZXdTaXplcyBmcm9tICcuLi8uLi8uLi8uLi9lbGVtZW50cy9QcmV2aWV3U2l6ZXMnXG5pbXBvcnQgVGh1bWJuYWlsIGZyb20gJy4uLy4uLy4uLy4uL2VsZW1lbnRzL1RodW1ibmFpbCdcbmltcG9ydCBFcnJvciBmcm9tICcuLi8uLi8uLi8uLi9mb3Jtcy9FcnJvcidcbmltcG9ydCByZWR1Y2VGaWVsZHNUb1ZhbHVlcyBmcm9tICcuLi8uLi8uLi8uLi9mb3Jtcy9Gb3JtL3JlZHVjZUZpZWxkc1RvVmFsdWVzJ1xuaW1wb3J0IHsgZmllbGRCYXNlQ2xhc3MgfSBmcm9tICcuLi8uLi8uLi8uLi9mb3Jtcy9maWVsZC10eXBlcy9zaGFyZWQnXG5pbXBvcnQgdXNlRmllbGQgZnJvbSAnLi4vLi4vLi4vLi4vZm9ybXMvdXNlRmllbGQnXG5pbXBvcnQgeyB1c2VEb2N1bWVudEluZm8gfSBmcm9tICcuLi8uLi8uLi8uLi91dGlsaXRpZXMvRG9jdW1lbnRJbmZvJ1xuaW1wb3J0IHsgdXNlVXBsb2FkRWRpdHMgfSBmcm9tICcuLi8uLi8uLi8uLi91dGlsaXRpZXMvVXBsb2FkRWRpdHMnXG5pbXBvcnQgJy4vaW5kZXguc2NzcydcblxuY29uc3QgYmFzZUNsYXNzID0gJ2ZpbGUtZmllbGQnXG5leHBvcnQgY29uc3QgZWRpdERyYXdlclNsdWcgPSAnZWRpdC11cGxvYWQnXG5leHBvcnQgY29uc3Qgc2l6ZVByZXZpZXdTbHVnID0gJ3ByZXZpZXctc2l6ZXMnXG5cbmNvbnN0IHZhbGlkYXRlID0gKHZhbHVlKSA9PiB7XG4gIGlmICghdmFsdWUgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiAnQSBmaWxlIGlzIHJlcXVpcmVkLidcbiAgfVxuXG4gIHJldHVybiB0cnVlXG59XG5cbmV4cG9ydCBjb25zdCBVcGxvYWRBY3Rpb25zID0gKHsgY2FuRWRpdCwgc2hvd1NpemVQcmV2aWV3cyB9KSA9PiB7XG4gIGNvbnN0IHsgdCB9ID0gdXNlVHJhbnNsYXRpb24oJ3VwbG9hZCcpXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2ZpbGUtbXV0YXRpb25gfT5cbiAgICAgIHtzaG93U2l6ZVByZXZpZXdzICYmIChcbiAgICAgICAgPERyYXdlclRvZ2dsZXIgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19wcmV2aWV3U2l6ZXNgfSBzbHVnPXtzaXplUHJldmlld1NsdWd9PlxuICAgICAgICAgIHt0KCd1cGxvYWQ6cHJldmlld1NpemVzJyl9XG4gICAgICAgIDwvRHJhd2VyVG9nZ2xlcj5cbiAgICAgICl9XG4gICAgICB7Y2FuRWRpdCAmJiAoXG4gICAgICAgIDxEcmF3ZXJUb2dnbGVyIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fZWRpdGB9IHNsdWc9e2VkaXREcmF3ZXJTbHVnfT5cbiAgICAgICAgICB7dCgndXBsb2FkOmVkaXRJbWFnZScpfVxuICAgICAgICA8L0RyYXdlclRvZ2dsZXI+XG4gICAgICApfVxuICAgIDwvZGl2PlxuICApXG59XG5cbmV4cG9ydCBjb25zdCBVcGxvYWQ6IFJlYWN0LkZDPFByb3BzPiA9IChwcm9wcykgPT4ge1xuICBjb25zdCB7IGNvbGxlY3Rpb24sIGludGVybmFsU3RhdGUsIG9uQ2hhbmdlIH0gPSBwcm9wc1xuICBjb25zdCBbcmVwbGFjaW5nRmlsZSwgc2V0UmVwbGFjaW5nRmlsZV0gPSB1c2VTdGF0ZShmYWxzZSlcbiAgY29uc3QgW2ZpbGVTcmMsIHNldEZpbGVTcmNdID0gdXNlU3RhdGU8bnVsbCB8IHN0cmluZz4obnVsbClcbiAgY29uc3QgeyB0IH0gPSB1c2VUcmFuc2xhdGlvbihbJ3VwbG9hZCcsICdnZW5lcmFsJ10pXG4gIGNvbnN0IHsgcmVzZXRVcGxvYWRFZGl0cyB9ID0gdXNlVXBsb2FkRWRpdHMoKVxuICBjb25zdCBbZG9jLCBzZXREb2NdID0gdXNlU3RhdGUocmVkdWNlRmllbGRzVG9WYWx1ZXMoaW50ZXJuYWxTdGF0ZSB8fCB7fSwgdHJ1ZSkpXG4gIGNvbnN0IHsgZG9jUGVybWlzc2lvbnMgfSA9IHVzZURvY3VtZW50SW5mbygpXG4gIGNvbnN0IHsgZXJyb3JNZXNzYWdlLCBzZXRWYWx1ZSwgc2hvd0Vycm9yLCB2YWx1ZSB9ID0gdXNlRmllbGQ8RmlsZT4oe1xuICAgIHBhdGg6ICdmaWxlJyxcbiAgICB2YWxpZGF0ZSxcbiAgfSlcblxuICBjb25zdCBbc2hvd1VybElucHV0LCBzZXRTaG93VXJsSW5wdXRdID0gdXNlU3RhdGUoZmFsc2UpXG4gIGNvbnN0IFtmaWxlVXJsLCBzZXRGaWxlVXJsXSA9IHVzZVN0YXRlPHN0cmluZz4oJycpXG5cbiAgY29uc3QgY3Vyc29yUG9zaXRpb25SZWYgPSB1c2VSZWYobnVsbClcbiAgY29uc3QgdXJsSW5wdXRSZWYgPSB1c2VSZWY8SFRNTElucHV0RWxlbWVudD4obnVsbClcblxuICBjb25zdCBoYW5kbGVGaWxlQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgKG5ld0ZpbGU6IEZpbGUpID0+IHtcbiAgICAgIGlmIChuZXdGaWxlIGluc3RhbmNlb2YgRmlsZSkge1xuICAgICAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7XG4gICAgICAgICAgY29uc3QgaW1nU3JjID0gZS50YXJnZXQ/LnJlc3VsdFxuXG4gICAgICAgICAgaWYgKHR5cGVvZiBpbWdTcmMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBzZXRGaWxlU3JjKGltZ1NyYylcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNEYXRhVVJMKG5ld0ZpbGUpXG4gICAgICB9XG5cbiAgICAgIHNldFZhbHVlKG5ld0ZpbGUpXG4gICAgICBzZXRTaG93VXJsSW5wdXQoZmFsc2UpXG5cbiAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgb25DaGFuZ2UobmV3RmlsZSlcbiAgICAgIH1cbiAgICB9LFxuICAgIFtvbkNoYW5nZSwgc2V0VmFsdWVdLFxuICApXG5cbiAgY29uc3QgaGFuZGxlRmlsZU5hbWVDaGFuZ2UgPSAoZTogUmVhY3QuQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICBjb25zdCB1cGRhdGVkRmlsZU5hbWUgPSBlLnRhcmdldC52YWx1ZVxuICAgIGNvbnN0IGN1cnNvclBvc2l0aW9uID0gZS50YXJnZXQuc2VsZWN0aW9uU3RhcnRcblxuICAgIGN1cnNvclBvc2l0aW9uUmVmLmN1cnJlbnQgPSBjdXJzb3JQb3NpdGlvblxuXG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICBjb25zdCBmaWxlVmFsdWUgPSB2YWx1ZVxuICAgICAgLy8gQ3JlYXRpbmcgYSBuZXcgRmlsZSBvYmplY3Qgd2l0aCB1cGRhdGVkIHByb3BlcnRpZXNcbiAgICAgIGNvbnN0IG5ld0ZpbGUgPSBuZXcgRmlsZShbZmlsZVZhbHVlXSwgdXBkYXRlZEZpbGVOYW1lLCB7IHR5cGU6IGZpbGVWYWx1ZS50eXBlIH0pXG4gICAgICBoYW5kbGVGaWxlQ2hhbmdlKG5ld0ZpbGUpXG4gICAgfVxuICB9XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVubmVjZXNzYXJ5LXR5cGUtYXNzZXJ0aW9uXG4gICAgY29uc3QgaW5wdXRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7YmFzZUNsYXNzfV9fZmlsZW5hbWVgKSBhcyBIVE1MSW5wdXRFbGVtZW50XG4gICAgaWYgKGlucHV0RWxlbWVudCAmJiBjdXJzb3JQb3NpdGlvblJlZi5jdXJyZW50ICE9PSBudWxsKSB7XG4gICAgICBpbnB1dEVsZW1lbnQuc2V0U2VsZWN0aW9uUmFuZ2UoY3Vyc29yUG9zaXRpb25SZWYuY3VycmVudCwgY3Vyc29yUG9zaXRpb25SZWYuY3VycmVudClcbiAgICB9XG4gIH0sIFt2YWx1ZV0pXG5cbiAgY29uc3QgaGFuZGxlRmlsZVNlbGVjdGlvbiA9IFJlYWN0LnVzZUNhbGxiYWNrKFxuICAgIChmaWxlczogRmlsZUxpc3QpID0+IHtcbiAgICAgIGNvbnN0IGZpbGVUb1VwbG9hZCA9IGZpbGVzPy5bMF1cbiAgICAgIGhhbmRsZUZpbGVDaGFuZ2UoZmlsZVRvVXBsb2FkKVxuICAgIH0sXG4gICAgW2hhbmRsZUZpbGVDaGFuZ2VdLFxuICApXG5cbiAgY29uc3QgaGFuZGxlRmlsZVJlbW92YWwgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0UmVwbGFjaW5nRmlsZSh0cnVlKVxuICAgIGhhbmRsZUZpbGVDaGFuZ2UobnVsbClcbiAgICBzZXRGaWxlU3JjKCcnKVxuICAgIHNldEZpbGVVcmwoJycpXG4gICAgc2V0RG9jKHt9KVxuICAgIHJlc2V0VXBsb2FkRWRpdHMoKVxuICAgIHNldFNob3dVcmxJbnB1dChmYWxzZSlcbiAgfSwgW2hhbmRsZUZpbGVDaGFuZ2UsIHJlc2V0VXBsb2FkRWRpdHNdKVxuXG4gIGNvbnN0IGhhbmRsZVBhc3RlVXJsQ2xpY2sgPSAoKSA9PiB7XG4gICAgc2V0U2hvd1VybElucHV0KChwcmV2KSA9PiAhcHJldilcbiAgfVxuXG4gIGNvbnN0IGhhbmRsZVVybFN1Ym1pdCA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoZmlsZVVybCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChmaWxlVXJsKVxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYmxvYigpXG5cbiAgICAgICAgLy8gRXh0cmFjdCB0aGUgZmlsZSBuYW1lIGZyb20gdGhlIFVSTFxuICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGZpbGVVcmwuc3BsaXQoJy8nKS5wb3AoKVxuXG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBGaWxlIG9iamVjdCBmcm9tIHRoZSBCbG9iIGRhdGFcbiAgICAgICAgY29uc3QgZmlsZSA9IG5ldyBGaWxlKFtkYXRhXSwgZmlsZU5hbWUsIHsgdHlwZTogZGF0YS50eXBlIH0pXG4gICAgICAgIGhhbmRsZUZpbGVDaGFuZ2UoZmlsZSlcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdG9hc3QuZXJyb3IoZS5tZXNzYWdlKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgc2V0RG9jKHJlZHVjZUZpZWxkc1RvVmFsdWVzKGludGVybmFsU3RhdGUgfHwge30sIHRydWUpKVxuICAgIHNldFJlcGxhY2luZ0ZpbGUoZmFsc2UpXG4gIH0sIFtpbnRlcm5hbFN0YXRlXSlcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChzaG93VXJsSW5wdXQgJiYgdXJsSW5wdXRSZWYuY3VycmVudCkge1xuICAgICAgdXJsSW5wdXRSZWYuY3VycmVudC5mb2N1cygpIC8vIEZvY3VzIG9uIHRoZSByZW1vdGUtdXJsIGlucHV0IGZpZWxkIHdoZW4gc2hvd1VybElucHV0IGlzIHRydWVcbiAgICB9XG4gIH0sIFtzaG93VXJsSW5wdXRdKVxuXG4gIGNvbnN0IGNhblJlbW92ZVVwbG9hZCA9XG4gICAgZG9jUGVybWlzc2lvbnM/LnVwZGF0ZT8ucGVybWlzc2lvbiAmJlxuICAgICdkZWxldGUnIGluIGRvY1Blcm1pc3Npb25zICYmXG4gICAgZG9jUGVybWlzc2lvbnM/LmRlbGV0ZT8ucGVybWlzc2lvblxuXG4gIGNvbnN0IGhhc0ltYWdlU2l6ZXMgPSBjb2xsZWN0aW9uPy51cGxvYWQ/LmltYWdlU2l6ZXM/Lmxlbmd0aCA+IDBcbiAgY29uc3QgaGFzUmVzaXplT3B0aW9ucyA9IEJvb2xlYW4oY29sbGVjdGlvbj8udXBsb2FkPy5yZXNpemVPcHRpb25zKVxuICAvLyBFeHBsaWNpdGx5IGNoZWNrIGlmIHNldCB0byB0cnVlLCBkZWZhdWx0IGlzIHVuZGVmaW5lZFxuICBjb25zdCBmb2NhbFBvaW50RW5hYmxlZCA9IGNvbGxlY3Rpb24/LnVwbG9hZD8uZm9jYWxQb2ludCA9PT0gdHJ1ZVxuXG4gIGNvbnN0IHsgY29sbGVjdGlvbjogeyB1cGxvYWQ6IHsgY3JvcDogc2hvd0Nyb3AgPSB0cnVlLCBmb2NhbFBvaW50ID0gdHJ1ZSB9IH0gPSB7fSB9ID0gcHJvcHNcblxuICBjb25zdCBzaG93Rm9jYWxQb2ludCA9IGZvY2FsUG9pbnQgJiYgKGhhc0ltYWdlU2l6ZXMgfHwgaGFzUmVzaXplT3B0aW9ucyB8fCBmb2NhbFBvaW50RW5hYmxlZClcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPXtbZmllbGRCYXNlQ2xhc3MsIGJhc2VDbGFzc10uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJyAnKX0+XG4gICAgICA8RXJyb3IgbWVzc2FnZT17ZXJyb3JNZXNzYWdlfSBzaG93RXJyb3I9e3Nob3dFcnJvcn0gLz5cblxuICAgICAge2RvYy5maWxlbmFtZSAmJiAhcmVwbGFjaW5nRmlsZSAmJiAoXG4gICAgICAgIDxGaWxlRGV0YWlsc1xuICAgICAgICAgIGNhbkVkaXQ9e3Nob3dDcm9wIHx8IHNob3dGb2NhbFBvaW50fVxuICAgICAgICAgIGNvbGxlY3Rpb249e2NvbGxlY3Rpb259XG4gICAgICAgICAgZG9jPXtkb2N9XG4gICAgICAgICAgaGFuZGxlUmVtb3ZlPXtjYW5SZW1vdmVVcGxvYWQgPyBoYW5kbGVGaWxlUmVtb3ZhbCA6IHVuZGVmaW5lZH1cbiAgICAgICAgICBoYXNJbWFnZVNpemVzPXtoYXNJbWFnZVNpemVzfVxuICAgICAgICAgIGltYWdlQ2FjaGVUYWc9e2RvYy51cGRhdGVkQXR9XG4gICAgICAgIC8+XG4gICAgICApfVxuICAgICAgeyghZG9jLmZpbGVuYW1lIHx8IHJlcGxhY2luZ0ZpbGUpICYmIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3VwbG9hZGB9PlxuICAgICAgICAgIHshdmFsdWUgJiYgIXNob3dVcmxJbnB1dCAmJiAoXG4gICAgICAgICAgICA8RHJvcHpvbmVcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19kcm9wem9uZWB9XG4gICAgICAgICAgICAgIG1pbWVUeXBlcz17Y29sbGVjdGlvbj8udXBsb2FkPy5taW1lVHlwZXN9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVGaWxlU2VsZWN0aW9ufVxuICAgICAgICAgICAgICBvblBhc3RlVXJsQ2xpY2s9e2hhbmRsZVBhc3RlVXJsQ2xpY2t9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICl9XG4gICAgICAgICAge3Nob3dVcmxJbnB1dCAmJiAoXG4gICAgICAgICAgICA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19yZW1vdGUtZmlsZS13cmFwYH0+XG4gICAgICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3JlbW90ZS1maWxlYH1cbiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzZXRGaWxlVXJsKGUudGFyZ2V0LnZhbHVlKVxuICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgIHJlZj17dXJsSW5wdXRSZWZ9XG4gICAgICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgICAgICB2YWx1ZT17ZmlsZVVybH1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19hZGQtZmlsZS13cmFwYH0+XG4gICAgICAgICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fYWRkLWZpbGVgfVxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVVcmxTdWJtaXR9XG4gICAgICAgICAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICB7dCgndXBsb2FkOmFkZEltYWdlJyl9XG4gICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICBidXR0b25TdHlsZT1cImljb24tbGFiZWxcIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fcmVtb3ZlYH1cbiAgICAgICAgICAgICAgICBpY29uPVwieFwiXG4gICAgICAgICAgICAgICAgaWNvblN0eWxlPVwid2l0aC1ib3JkZXJcIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUZpbGVSZW1vdmFsfVxuICAgICAgICAgICAgICAgIHJvdW5kXG4gICAgICAgICAgICAgICAgdG9vbHRpcD17dCgnZ2VuZXJhbDpjYW5jZWwnKX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvUmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgKX1cbiAgICAgICAgICB7dmFsdWUgJiYgKFxuICAgICAgICAgICAgPFJlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fdGh1bWJuYWlsLXdyYXBgfT5cbiAgICAgICAgICAgICAgICA8VGh1bWJuYWlsIGZpbGVTcmM9e2lzSW1hZ2UodmFsdWUudHlwZSkgPyBmaWxlU3JjIDogbnVsbH0gLz5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19maWxlLWFkanVzdG1lbnRzYH0+XG4gICAgICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2ZpbGVuYW1lYH1cbiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVGaWxlTmFtZUNoYW5nZX1cbiAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICAgIHZhbHVlPXt2YWx1ZS5uYW1lfVxuICAgICAgICAgICAgICAgIC8+XG5cbiAgICAgICAgICAgICAgICB7aXNJbWFnZSh2YWx1ZS50eXBlKSAmJiB2YWx1ZS50eXBlICE9PSAnaW1hZ2Uvc3ZnK3htbCcgJiYgKFxuICAgICAgICAgICAgICAgICAgPFVwbG9hZEFjdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgY2FuRWRpdD17c2hvd0Nyb3AgfHwgc2hvd0ZvY2FsUG9pbnR9XG4gICAgICAgICAgICAgICAgICAgIHNob3dTaXplUHJldmlld3M9e2hhc0ltYWdlU2l6ZXMgJiYgZG9jLmZpbGVuYW1lICYmICFyZXBsYWNpbmdGaWxlfVxuICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwiaWNvbi1sYWJlbFwiXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19yZW1vdmVgfVxuICAgICAgICAgICAgICAgIGljb249XCJ4XCJcbiAgICAgICAgICAgICAgICBpY29uU3R5bGU9XCJ3aXRoLWJvcmRlclwiXG4gICAgICAgICAgICAgICAgb25DbGljaz17aGFuZGxlRmlsZVJlbW92YWx9XG4gICAgICAgICAgICAgICAgcm91bmRcbiAgICAgICAgICAgICAgICB0b29sdGlwPXt0KCdnZW5lcmFsOmNhbmNlbCcpfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9SZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICApfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICl9XG5cbiAgICAgIHsodmFsdWUgfHwgZG9jLmZpbGVuYW1lKSAmJiAoXG4gICAgICAgIDxEcmF3ZXIgaGVhZGVyPXtudWxsfSBzbHVnPXtlZGl0RHJhd2VyU2x1Z30+XG4gICAgICAgICAgPEVkaXRVcGxvYWRcbiAgICAgICAgICAgIGRvYz17ZG9jIHx8IHVuZGVmaW5lZH1cbiAgICAgICAgICAgIGZpbGVOYW1lPXt2YWx1ZT8ubmFtZSB8fCBkb2M/LmZpbGVuYW1lfVxuICAgICAgICAgICAgZmlsZVNyYz17ZG9jPy51cmwgfHwgZmlsZVNyY31cbiAgICAgICAgICAgIGltYWdlQ2FjaGVUYWc9e2RvYy51cGRhdGVkQXR9XG4gICAgICAgICAgICBzaG93Q3JvcD17c2hvd0Nyb3B9XG4gICAgICAgICAgICBzaG93Rm9jYWxQb2ludD17c2hvd0ZvY2FsUG9pbnR9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9EcmF3ZXI+XG4gICAgICApfVxuICAgICAge2RvYyAmJiBoYXNJbWFnZVNpemVzICYmIChcbiAgICAgICAgPERyYXdlclxuICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fcHJldmlld0RyYXdlcmB9XG4gICAgICAgICAgaG92ZXJUaXRsZVxuICAgICAgICAgIHNsdWc9e3NpemVQcmV2aWV3U2x1Z31cbiAgICAgICAgICB0aXRsZT17dCgndXBsb2FkOnNpemVzRm9yJywgeyBsYWJlbDogZG9jPy5maWxlbmFtZSB9KX1cbiAgICAgICAgPlxuICAgICAgICAgIDxQcmV2aWV3U2l6ZXMgY29sbGVjdGlvbj17Y29sbGVjdGlvbn0gZG9jPXtkb2N9IGltYWdlQ2FjaGVUYWc9e2RvYy51cGRhdGVkQXR9IC8+XG4gICAgICAgIDwvRHJhd2VyPlxuICAgICAgKX1cbiAgICA8L2Rpdj5cbiAgKVxufVxuIl0sIm5hbWVzIjpbIlVwbG9hZCIsIlVwbG9hZEFjdGlvbnMiLCJlZGl0RHJhd2VyU2x1ZyIsInNpemVQcmV2aWV3U2x1ZyIsImJhc2VDbGFzcyIsInZhbGlkYXRlIiwidmFsdWUiLCJ1bmRlZmluZWQiLCJjYW5FZGl0Iiwic2hvd1NpemVQcmV2aWV3cyIsInQiLCJ1c2VUcmFuc2xhdGlvbiIsImRpdiIsImNsYXNzTmFtZSIsIkRyYXdlclRvZ2dsZXIiLCJzbHVnIiwicHJvcHMiLCJjb2xsZWN0aW9uIiwiaW50ZXJuYWxTdGF0ZSIsIm9uQ2hhbmdlIiwicmVwbGFjaW5nRmlsZSIsInNldFJlcGxhY2luZ0ZpbGUiLCJ1c2VTdGF0ZSIsImZpbGVTcmMiLCJzZXRGaWxlU3JjIiwicmVzZXRVcGxvYWRFZGl0cyIsInVzZVVwbG9hZEVkaXRzIiwiZG9jIiwic2V0RG9jIiwicmVkdWNlRmllbGRzVG9WYWx1ZXMiLCJkb2NQZXJtaXNzaW9ucyIsInVzZURvY3VtZW50SW5mbyIsImVycm9yTWVzc2FnZSIsInNldFZhbHVlIiwic2hvd0Vycm9yIiwidXNlRmllbGQiLCJwYXRoIiwic2hvd1VybElucHV0Iiwic2V0U2hvd1VybElucHV0IiwiZmlsZVVybCIsInNldEZpbGVVcmwiLCJjdXJzb3JQb3NpdGlvblJlZiIsInVzZVJlZiIsInVybElucHV0UmVmIiwiaGFuZGxlRmlsZUNoYW5nZSIsInVzZUNhbGxiYWNrIiwibmV3RmlsZSIsIkZpbGUiLCJmaWxlUmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImUiLCJpbWdTcmMiLCJ0YXJnZXQiLCJyZXN1bHQiLCJyZWFkQXNEYXRhVVJMIiwiaGFuZGxlRmlsZU5hbWVDaGFuZ2UiLCJ1cGRhdGVkRmlsZU5hbWUiLCJjdXJzb3JQb3NpdGlvbiIsInNlbGVjdGlvblN0YXJ0IiwiY3VycmVudCIsImZpbGVWYWx1ZSIsInR5cGUiLCJ1c2VFZmZlY3QiLCJpbnB1dEVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImhhbmRsZUZpbGVTZWxlY3Rpb24iLCJSZWFjdCIsImZpbGVzIiwiZmlsZVRvVXBsb2FkIiwiaGFuZGxlRmlsZVJlbW92YWwiLCJoYW5kbGVQYXN0ZVVybENsaWNrIiwicHJldiIsImhhbmRsZVVybFN1Ym1pdCIsInJlc3BvbnNlIiwiZmV0Y2giLCJkYXRhIiwiYmxvYiIsImZpbGVOYW1lIiwic3BsaXQiLCJwb3AiLCJmaWxlIiwidG9hc3QiLCJlcnJvciIsIm1lc3NhZ2UiLCJmb2N1cyIsImNhblJlbW92ZVVwbG9hZCIsInVwZGF0ZSIsInBlcm1pc3Npb24iLCJkZWxldGUiLCJoYXNJbWFnZVNpemVzIiwidXBsb2FkIiwiaW1hZ2VTaXplcyIsImxlbmd0aCIsImhhc1Jlc2l6ZU9wdGlvbnMiLCJCb29sZWFuIiwicmVzaXplT3B0aW9ucyIsImZvY2FsUG9pbnRFbmFibGVkIiwiZm9jYWxQb2ludCIsImNyb3AiLCJzaG93Q3JvcCIsInNob3dGb2NhbFBvaW50IiwiZmllbGRCYXNlQ2xhc3MiLCJmaWx0ZXIiLCJqb2luIiwiRXJyb3IiLCJmaWxlbmFtZSIsIkZpbGVEZXRhaWxzIiwiaGFuZGxlUmVtb3ZlIiwiaW1hZ2VDYWNoZVRhZyIsInVwZGF0ZWRBdCIsIkRyb3B6b25lIiwibWltZVR5cGVzIiwib25QYXN0ZVVybENsaWNrIiwiRnJhZ21lbnQiLCJpbnB1dCIsInJlZiIsImJ1dHRvbiIsIm9uQ2xpY2siLCJCdXR0b24iLCJidXR0b25TdHlsZSIsImljb24iLCJpY29uU3R5bGUiLCJyb3VuZCIsInRvb2x0aXAiLCJUaHVtYm5haWwiLCJpc0ltYWdlIiwibmFtZSIsIkRyYXdlciIsImhlYWRlciIsIkVkaXRVcGxvYWQiLCJ1cmwiLCJob3ZlclRpdGxlIiwidGl0bGUiLCJsYWJlbCIsIlByZXZpZXdTaXplcyJdLCJyYW5nZU1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7SUFvRGFBLE1BQU07ZUFBTkE7O0lBbEJBQyxhQUFhO2VBQWJBOztJQVhBQyxjQUFjO2VBQWRBOztJQUNBQyxlQUFlO2VBQWZBOzs7K0RBeEJtRDs4QkFDakM7K0JBQ1Q7Z0VBSUY7K0RBQ0Q7d0JBQ21COzBCQUNiOzRCQUNFO29FQUNIO3FFQUNDO2tFQUNIOzhEQUNKOzZFQUNlO3dCQUNGO2lFQUNWOzhCQUNXOzZCQUNEO1FBQ3hCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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