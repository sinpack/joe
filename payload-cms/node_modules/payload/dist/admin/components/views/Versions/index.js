"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _getTranslation = require("../../../../utilities/getTranslation");
const _usePayloadAPI = /*#__PURE__*/ _interop_require_default(require("../../../hooks/usePayloadAPI"));
const _ActionsProvider = require("../../utilities/ActionsProvider");
const _Auth = require("../../utilities/Auth");
const _Config = require("../../utilities/Config");
const _EditDepth = require("../../utilities/EditDepth");
const _RenderCustomComponent = /*#__PURE__*/ _interop_require_default(require("../../utilities/RenderCustomComponent"));
const _SearchParams = require("../../utilities/SearchParams");
const _Default = require("./Default");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const VersionsView = (props)=>{
    const { id, collection, global } = props;
    const { permissions, user } = (0, _Auth.useAuth)();
    const [fetchURL, setFetchURL] = (0, _react.useState)('');
    const { setViewActions } = (0, _ActionsProvider.useActions)();
    const { routes: { admin, api }, serverURL } = (0, _Config.useConfig)();
    const { i18n } = (0, _reacti18next.useTranslation)('version');
    const { limit, page, sort } = (0, _SearchParams.useSearchParams)();
    let CustomVersionsView = null;
    let docURL;
    let entityLabel;
    let slug;
    let editURL;
    const [latestDraftVersion, setLatestDraftVersion] = (0, _react.useState)(undefined);
    const [latestPublishedVersion, setLatestPublishedVersion] = (0, _react.useState)(undefined);
    if (collection) {
        ({ slug } = collection);
        docURL = `${serverURL}${api}/${slug}/${id}`;
        entityLabel = (0, _getTranslation.getTranslation)(collection.labels.singular, i18n);
        editURL = `${admin}/collections/${collection.slug}/${id}`;
        // The component definition could come from multiple places in the config
        // we need to cascade into the proper component from the top-down
        // 1. "components.Edit"
        // 2. "components.Edit.Versions"
        // 3. "components.Edit.Versions.Component"
        const EditCollection = collection?.admin?.components?.views?.Edit;
        if (typeof EditCollection === 'function') {
            CustomVersionsView = EditCollection;
        } else if (typeof EditCollection === 'object' && typeof EditCollection.Versions === 'function') {
            CustomVersionsView = EditCollection.Versions;
        } else if (typeof EditCollection?.Versions === 'object' && 'Component' in EditCollection.Versions && typeof EditCollection.Versions.Component === 'function') {
            CustomVersionsView = EditCollection.Versions.Component;
        }
    }
    if (global) {
        ({ slug } = global);
        docURL = `${serverURL}${api}/globals/${slug}`;
        entityLabel = (0, _getTranslation.getTranslation)(global.label, i18n);
        editURL = `${admin}/globals/${global.slug}`;
        // See note above about cascading component definitions
        const EditGlobal = global?.admin?.components?.views?.Edit;
        if (typeof EditGlobal === 'function') {
            CustomVersionsView = EditGlobal;
        } else if (typeof EditGlobal === 'object' && typeof EditGlobal.Versions === 'function') {
            CustomVersionsView = EditGlobal.Versions;
        } else if (typeof EditGlobal?.Versions === 'object' && 'Component' in EditGlobal.Versions && typeof EditGlobal.Versions.Component === 'function') {
            CustomVersionsView = EditGlobal.Versions.Component;
        }
    }
    const [{ data, isLoading }] = (0, _usePayloadAPI.default)(docURL, {
        initialParams: {
            draft: 'true'
        }
    });
    const [{ data: versionsData, isLoading: isLoadingVersions }, { setParams }] = (0, _usePayloadAPI.default)(fetchURL);
    const sharedParams = (status)=>{
        return {
            depth: 0,
            limit: 1,
            sort: '-updatedAt',
            where: {
                'version._status': {
                    equals: status
                }
            }
        };
    };
    const [{ data: draft }] = (0, _usePayloadAPI.default)(fetchURL, {
        initialParams: {
            ...sharedParams('draft')
        }
    });
    const [{ data: published }] = (0, _usePayloadAPI.default)(fetchURL, {
        initialParams: {
            ...sharedParams('published')
        }
    });
    (0, _react.useEffect)(()=>{
        const formattedPublished = published?.docs?.length > 0 && published?.docs[0];
        const formattedDraft = draft?.docs?.length > 0 && draft?.docs[0];
        if (!formattedPublished || !formattedDraft) return;
        const publishedNewerThanDraft = formattedPublished?.updatedAt > formattedDraft?.updatedAt;
        setLatestDraftVersion(publishedNewerThanDraft ? undefined : formattedDraft?.id);
        setLatestPublishedVersion(formattedPublished.latest ? formattedPublished?.id : undefined);
    }, [
        draft,
        published
    ]);
    (0, _react.useEffect)(()=>{
        const params = {
            depth: 1,
            limit,
            page: undefined,
            sort: undefined,
            where: {}
        };
        if (page) params.page = page;
        if (sort) params.sort = sort;
        let fetchURLToSet;
        if (collection) {
            fetchURLToSet = `${serverURL}${api}/${collection.slug}/versions`;
            params.where = {
                parent: {
                    equals: id
                }
            };
        }
        if (global) {
            fetchURLToSet = `${serverURL}${api}/globals/${global.slug}/versions`;
        }
        // Performance enhancement
        // Setting the Fetch URL this way
        // prevents a double-fetch
        setFetchURL(fetchURLToSet);
        setParams(params);
    }, [
        setParams,
        page,
        sort,
        limit,
        serverURL,
        api,
        id,
        global,
        collection
    ]);
    (0, _react.useEffect)(()=>{
        const editConfig = (collection || global)?.admin?.components?.views?.Edit;
        const versionsActions = editConfig && 'Versions' in editConfig && 'actions' in editConfig.Versions ? editConfig.Versions.actions : [];
        setViewActions(versionsActions);
        return ()=>{
            setViewActions([]);
        };
    }, [
        collection,
        global,
        setViewActions
    ]);
    return /*#__PURE__*/ _react.default.createElement(_EditDepth.EditDepthContext.Provider, {
        value: 1
    }, /*#__PURE__*/ _react.default.createElement(_RenderCustomComponent.default, {
        CustomComponent: CustomVersionsView,
        DefaultComponent: _Default.DefaultVersionsView,
        componentProps: {
            id,
            canAccessAdmin: permissions?.canAccessAdmin,
            collection,
            data,
            editURL,
            entityLabel,
            fetchURL,
            global,
            isLoading,
            isLoadingVersions,
            latestDraftVersion,
            latestPublishedVersion,
            user,
            versionsData
        }
    }));
};
const _default = VersionsView;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL3ZpZXdzL1ZlcnNpb25zL2luZGV4LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgdXNlVHJhbnNsYXRpb24gfSBmcm9tICdyZWFjdC1pMThuZXh0J1xuXG5pbXBvcnQgdHlwZSB7IEluZGV4UHJvcHMgfSBmcm9tICcuL3R5cGVzJ1xuXG5pbXBvcnQgeyBnZXRUcmFuc2xhdGlvbiB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxpdGllcy9nZXRUcmFuc2xhdGlvbidcbmltcG9ydCB1c2VQYXlsb2FkQVBJIGZyb20gJy4uLy4uLy4uL2hvb2tzL3VzZVBheWxvYWRBUEknXG5pbXBvcnQgeyB1c2VBY3Rpb25zIH0gZnJvbSAnLi4vLi4vdXRpbGl0aWVzL0FjdGlvbnNQcm92aWRlcidcbmltcG9ydCB7IHVzZUF1dGggfSBmcm9tICcuLi8uLi91dGlsaXRpZXMvQXV0aCdcbmltcG9ydCB7IHVzZUNvbmZpZyB9IGZyb20gJy4uLy4uL3V0aWxpdGllcy9Db25maWcnXG5pbXBvcnQgeyBFZGl0RGVwdGhDb250ZXh0IH0gZnJvbSAnLi4vLi4vdXRpbGl0aWVzL0VkaXREZXB0aCdcbmltcG9ydCBSZW5kZXJDdXN0b21Db21wb25lbnQgZnJvbSAnLi4vLi4vdXRpbGl0aWVzL1JlbmRlckN1c3RvbUNvbXBvbmVudCdcbmltcG9ydCB7IHVzZVNlYXJjaFBhcmFtcyB9IGZyb20gJy4uLy4uL3V0aWxpdGllcy9TZWFyY2hQYXJhbXMnXG5pbXBvcnQgeyBEZWZhdWx0VmVyc2lvbnNWaWV3IH0gZnJvbSAnLi9EZWZhdWx0J1xuXG5jb25zdCBWZXJzaW9uc1ZpZXc6IFJlYWN0LkZDPEluZGV4UHJvcHM+ID0gKHByb3BzKSA9PiB7XG4gIGNvbnN0IHsgaWQsIGNvbGxlY3Rpb24sIGdsb2JhbCB9ID0gcHJvcHNcblxuICBjb25zdCB7IHBlcm1pc3Npb25zLCB1c2VyIH0gPSB1c2VBdXRoKClcblxuICBjb25zdCBbZmV0Y2hVUkwsIHNldEZldGNoVVJMXSA9IHVzZVN0YXRlKCcnKVxuXG4gIGNvbnN0IHsgc2V0Vmlld0FjdGlvbnMgfSA9IHVzZUFjdGlvbnMoKVxuXG4gIGNvbnN0IHtcbiAgICByb3V0ZXM6IHsgYWRtaW4sIGFwaSB9LFxuICAgIHNlcnZlclVSTCxcbiAgfSA9IHVzZUNvbmZpZygpXG5cbiAgY29uc3QgeyBpMThuIH0gPSB1c2VUcmFuc2xhdGlvbigndmVyc2lvbicpXG5cbiAgY29uc3QgeyBsaW1pdCwgcGFnZSwgc29ydCB9ID0gdXNlU2VhcmNoUGFyYW1zKClcblxuICBsZXQgQ3VzdG9tVmVyc2lvbnNWaWV3OiBSZWFjdC5Db21wb25lbnRUeXBlIHwgbnVsbCA9IG51bGxcbiAgbGV0IGRvY1VSTDogc3RyaW5nXG4gIGxldCBlbnRpdHlMYWJlbDogc3RyaW5nXG4gIGxldCBzbHVnOiBzdHJpbmdcbiAgbGV0IGVkaXRVUkw6IHN0cmluZ1xuICBjb25zdCBbbGF0ZXN0RHJhZnRWZXJzaW9uLCBzZXRMYXRlc3REcmFmdFZlcnNpb25dID0gdXNlU3RhdGUodW5kZWZpbmVkKVxuICBjb25zdCBbbGF0ZXN0UHVibGlzaGVkVmVyc2lvbiwgc2V0TGF0ZXN0UHVibGlzaGVkVmVyc2lvbl0gPSB1c2VTdGF0ZSh1bmRlZmluZWQpXG5cbiAgaWYgKGNvbGxlY3Rpb24pIHtcbiAgICA7KHsgc2x1ZyB9ID0gY29sbGVjdGlvbilcbiAgICBkb2NVUkwgPSBgJHtzZXJ2ZXJVUkx9JHthcGl9LyR7c2x1Z30vJHtpZH1gXG4gICAgZW50aXR5TGFiZWwgPSBnZXRUcmFuc2xhdGlvbihjb2xsZWN0aW9uLmxhYmVscy5zaW5ndWxhciwgaTE4bilcbiAgICBlZGl0VVJMID0gYCR7YWRtaW59L2NvbGxlY3Rpb25zLyR7Y29sbGVjdGlvbi5zbHVnfS8ke2lkfWBcblxuICAgIC8vIFRoZSBjb21wb25lbnQgZGVmaW5pdGlvbiBjb3VsZCBjb21lIGZyb20gbXVsdGlwbGUgcGxhY2VzIGluIHRoZSBjb25maWdcbiAgICAvLyB3ZSBuZWVkIHRvIGNhc2NhZGUgaW50byB0aGUgcHJvcGVyIGNvbXBvbmVudCBmcm9tIHRoZSB0b3AtZG93blxuICAgIC8vIDEuIFwiY29tcG9uZW50cy5FZGl0XCJcbiAgICAvLyAyLiBcImNvbXBvbmVudHMuRWRpdC5WZXJzaW9uc1wiXG4gICAgLy8gMy4gXCJjb21wb25lbnRzLkVkaXQuVmVyc2lvbnMuQ29tcG9uZW50XCJcbiAgICBjb25zdCBFZGl0Q29sbGVjdGlvbiA9IGNvbGxlY3Rpb24/LmFkbWluPy5jb21wb25lbnRzPy52aWV3cz8uRWRpdFxuXG4gICAgaWYgKHR5cGVvZiBFZGl0Q29sbGVjdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgQ3VzdG9tVmVyc2lvbnNWaWV3ID0gRWRpdENvbGxlY3Rpb25cbiAgICB9IGVsc2UgaWYgKFxuICAgICAgdHlwZW9mIEVkaXRDb2xsZWN0aW9uID09PSAnb2JqZWN0JyAmJlxuICAgICAgdHlwZW9mIEVkaXRDb2xsZWN0aW9uLlZlcnNpb25zID09PSAnZnVuY3Rpb24nXG4gICAgKSB7XG4gICAgICBDdXN0b21WZXJzaW9uc1ZpZXcgPSBFZGl0Q29sbGVjdGlvbi5WZXJzaW9uc1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICB0eXBlb2YgRWRpdENvbGxlY3Rpb24/LlZlcnNpb25zID09PSAnb2JqZWN0JyAmJlxuICAgICAgJ0NvbXBvbmVudCcgaW4gRWRpdENvbGxlY3Rpb24uVmVyc2lvbnMgJiZcbiAgICAgIHR5cGVvZiBFZGl0Q29sbGVjdGlvbi5WZXJzaW9ucy5Db21wb25lbnQgPT09ICdmdW5jdGlvbidcbiAgICApIHtcbiAgICAgIEN1c3RvbVZlcnNpb25zVmlldyA9IEVkaXRDb2xsZWN0aW9uLlZlcnNpb25zLkNvbXBvbmVudFxuICAgIH1cbiAgfVxuXG4gIGlmIChnbG9iYWwpIHtcbiAgICA7KHsgc2x1ZyB9ID0gZ2xvYmFsKVxuICAgIGRvY1VSTCA9IGAke3NlcnZlclVSTH0ke2FwaX0vZ2xvYmFscy8ke3NsdWd9YFxuICAgIGVudGl0eUxhYmVsID0gZ2V0VHJhbnNsYXRpb24oZ2xvYmFsLmxhYmVsLCBpMThuKVxuICAgIGVkaXRVUkwgPSBgJHthZG1pbn0vZ2xvYmFscy8ke2dsb2JhbC5zbHVnfWBcblxuICAgIC8vIFNlZSBub3RlIGFib3ZlIGFib3V0IGNhc2NhZGluZyBjb21wb25lbnQgZGVmaW5pdGlvbnNcbiAgICBjb25zdCBFZGl0R2xvYmFsID0gZ2xvYmFsPy5hZG1pbj8uY29tcG9uZW50cz8udmlld3M/LkVkaXRcblxuICAgIGlmICh0eXBlb2YgRWRpdEdsb2JhbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgQ3VzdG9tVmVyc2lvbnNWaWV3ID0gRWRpdEdsb2JhbFxuICAgIH0gZWxzZSBpZiAodHlwZW9mIEVkaXRHbG9iYWwgPT09ICdvYmplY3QnICYmIHR5cGVvZiBFZGl0R2xvYmFsLlZlcnNpb25zID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBDdXN0b21WZXJzaW9uc1ZpZXcgPSBFZGl0R2xvYmFsLlZlcnNpb25zXG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHR5cGVvZiBFZGl0R2xvYmFsPy5WZXJzaW9ucyA9PT0gJ29iamVjdCcgJiZcbiAgICAgICdDb21wb25lbnQnIGluIEVkaXRHbG9iYWwuVmVyc2lvbnMgJiZcbiAgICAgIHR5cGVvZiBFZGl0R2xvYmFsLlZlcnNpb25zLkNvbXBvbmVudCA9PT0gJ2Z1bmN0aW9uJ1xuICAgICkge1xuICAgICAgQ3VzdG9tVmVyc2lvbnNWaWV3ID0gRWRpdEdsb2JhbC5WZXJzaW9ucy5Db21wb25lbnRcbiAgICB9XG4gIH1cblxuICBjb25zdCBbeyBkYXRhLCBpc0xvYWRpbmcgfV0gPSB1c2VQYXlsb2FkQVBJKGRvY1VSTCwgeyBpbml0aWFsUGFyYW1zOiB7IGRyYWZ0OiAndHJ1ZScgfSB9KVxuICBjb25zdCBbeyBkYXRhOiB2ZXJzaW9uc0RhdGEsIGlzTG9hZGluZzogaXNMb2FkaW5nVmVyc2lvbnMgfSwgeyBzZXRQYXJhbXMgfV0gPVxuICAgIHVzZVBheWxvYWRBUEkoZmV0Y2hVUkwpXG5cbiAgY29uc3Qgc2hhcmVkUGFyYW1zID0gKHN0YXR1cykgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBkZXB0aDogMCxcbiAgICAgIGxpbWl0OiAxLFxuICAgICAgc29ydDogJy11cGRhdGVkQXQnLFxuICAgICAgd2hlcmU6IHtcbiAgICAgICAgJ3ZlcnNpb24uX3N0YXR1cyc6IHtcbiAgICAgICAgICBlcXVhbHM6IHN0YXR1cyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfVxuICB9XG5cbiAgY29uc3QgW3sgZGF0YTogZHJhZnQgfV0gPSB1c2VQYXlsb2FkQVBJKGZldGNoVVJMLCB7XG4gICAgaW5pdGlhbFBhcmFtczogeyAuLi5zaGFyZWRQYXJhbXMoJ2RyYWZ0JykgfSxcbiAgfSlcblxuICBjb25zdCBbeyBkYXRhOiBwdWJsaXNoZWQgfV0gPSB1c2VQYXlsb2FkQVBJKGZldGNoVVJMLCB7XG4gICAgaW5pdGlhbFBhcmFtczogeyAuLi5zaGFyZWRQYXJhbXMoJ3B1Ymxpc2hlZCcpIH0sXG4gIH0pXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBmb3JtYXR0ZWRQdWJsaXNoZWQgPSBwdWJsaXNoZWQ/LmRvY3M/Lmxlbmd0aCA+IDAgJiYgcHVibGlzaGVkPy5kb2NzWzBdXG4gICAgY29uc3QgZm9ybWF0dGVkRHJhZnQgPSBkcmFmdD8uZG9jcz8ubGVuZ3RoID4gMCAmJiBkcmFmdD8uZG9jc1swXVxuXG4gICAgaWYgKCFmb3JtYXR0ZWRQdWJsaXNoZWQgfHwgIWZvcm1hdHRlZERyYWZ0KSByZXR1cm5cblxuICAgIGNvbnN0IHB1Ymxpc2hlZE5ld2VyVGhhbkRyYWZ0ID0gZm9ybWF0dGVkUHVibGlzaGVkPy51cGRhdGVkQXQgPiBmb3JtYXR0ZWREcmFmdD8udXBkYXRlZEF0XG4gICAgc2V0TGF0ZXN0RHJhZnRWZXJzaW9uKHB1Ymxpc2hlZE5ld2VyVGhhbkRyYWZ0ID8gdW5kZWZpbmVkIDogZm9ybWF0dGVkRHJhZnQ/LmlkKVxuICAgIHNldExhdGVzdFB1Ymxpc2hlZFZlcnNpb24oZm9ybWF0dGVkUHVibGlzaGVkLmxhdGVzdCA/IGZvcm1hdHRlZFB1Ymxpc2hlZD8uaWQgOiB1bmRlZmluZWQpXG4gIH0sIFtkcmFmdCwgcHVibGlzaGVkXSlcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgIGRlcHRoOiAxLFxuICAgICAgbGltaXQsXG4gICAgICBwYWdlOiB1bmRlZmluZWQsXG4gICAgICBzb3J0OiB1bmRlZmluZWQsXG4gICAgICB3aGVyZToge30sXG4gICAgfVxuXG4gICAgaWYgKHBhZ2UpIHBhcmFtcy5wYWdlID0gcGFnZVxuICAgIGlmIChzb3J0KSBwYXJhbXMuc29ydCA9IHNvcnRcblxuICAgIGxldCBmZXRjaFVSTFRvU2V0OiBzdHJpbmdcblxuICAgIGlmIChjb2xsZWN0aW9uKSB7XG4gICAgICBmZXRjaFVSTFRvU2V0ID0gYCR7c2VydmVyVVJMfSR7YXBpfS8ke2NvbGxlY3Rpb24uc2x1Z30vdmVyc2lvbnNgXG4gICAgICBwYXJhbXMud2hlcmUgPSB7XG4gICAgICAgIHBhcmVudDoge1xuICAgICAgICAgIGVxdWFsczogaWQsXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGdsb2JhbCkge1xuICAgICAgZmV0Y2hVUkxUb1NldCA9IGAke3NlcnZlclVSTH0ke2FwaX0vZ2xvYmFscy8ke2dsb2JhbC5zbHVnfS92ZXJzaW9uc2BcbiAgICB9XG5cbiAgICAvLyBQZXJmb3JtYW5jZSBlbmhhbmNlbWVudFxuICAgIC8vIFNldHRpbmcgdGhlIEZldGNoIFVSTCB0aGlzIHdheVxuICAgIC8vIHByZXZlbnRzIGEgZG91YmxlLWZldGNoXG5cbiAgICBzZXRGZXRjaFVSTChmZXRjaFVSTFRvU2V0KVxuXG4gICAgc2V0UGFyYW1zKHBhcmFtcylcbiAgfSwgW3NldFBhcmFtcywgcGFnZSwgc29ydCwgbGltaXQsIHNlcnZlclVSTCwgYXBpLCBpZCwgZ2xvYmFsLCBjb2xsZWN0aW9uXSlcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGVkaXRDb25maWcgPSAoY29sbGVjdGlvbiB8fCBnbG9iYWwpPy5hZG1pbj8uY29tcG9uZW50cz8udmlld3M/LkVkaXRcbiAgICBjb25zdCB2ZXJzaW9uc0FjdGlvbnMgPVxuICAgICAgZWRpdENvbmZpZyAmJiAnVmVyc2lvbnMnIGluIGVkaXRDb25maWcgJiYgJ2FjdGlvbnMnIGluIGVkaXRDb25maWcuVmVyc2lvbnNcbiAgICAgICAgPyBlZGl0Q29uZmlnLlZlcnNpb25zLmFjdGlvbnNcbiAgICAgICAgOiBbXVxuXG4gICAgc2V0Vmlld0FjdGlvbnModmVyc2lvbnNBY3Rpb25zKVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHNldFZpZXdBY3Rpb25zKFtdKVxuICAgIH1cbiAgfSwgW2NvbGxlY3Rpb24sIGdsb2JhbCwgc2V0Vmlld0FjdGlvbnNdKVxuXG4gIHJldHVybiAoXG4gICAgPEVkaXREZXB0aENvbnRleHQuUHJvdmlkZXIgdmFsdWU9ezF9PlxuICAgICAgPFJlbmRlckN1c3RvbUNvbXBvbmVudFxuICAgICAgICBDdXN0b21Db21wb25lbnQ9e0N1c3RvbVZlcnNpb25zVmlld31cbiAgICAgICAgRGVmYXVsdENvbXBvbmVudD17RGVmYXVsdFZlcnNpb25zVmlld31cbiAgICAgICAgY29tcG9uZW50UHJvcHM9e3tcbiAgICAgICAgICBpZCxcbiAgICAgICAgICBjYW5BY2Nlc3NBZG1pbjogcGVybWlzc2lvbnM/LmNhbkFjY2Vzc0FkbWluLFxuICAgICAgICAgIGNvbGxlY3Rpb24sXG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICBlZGl0VVJMLFxuICAgICAgICAgIGVudGl0eUxhYmVsLFxuICAgICAgICAgIGZldGNoVVJMLFxuICAgICAgICAgIGdsb2JhbCxcbiAgICAgICAgICBpc0xvYWRpbmcsXG4gICAgICAgICAgaXNMb2FkaW5nVmVyc2lvbnMsXG4gICAgICAgICAgbGF0ZXN0RHJhZnRWZXJzaW9uLFxuICAgICAgICAgIGxhdGVzdFB1Ymxpc2hlZFZlcnNpb24sXG4gICAgICAgICAgdXNlcixcbiAgICAgICAgICB2ZXJzaW9uc0RhdGEsXG4gICAgICAgIH19XG4gICAgICAvPlxuICAgIDwvRWRpdERlcHRoQ29udGV4dC5Qcm92aWRlcj5cbiAgKVxufVxuZXhwb3J0IGRlZmF1bHQgVmVyc2lvbnNWaWV3XG4iXSwibmFtZXMiOlsiVmVyc2lvbnNWaWV3IiwicHJvcHMiLCJpZCIsImNvbGxlY3Rpb24iLCJnbG9iYWwiLCJwZXJtaXNzaW9ucyIsInVzZXIiLCJ1c2VBdXRoIiwiZmV0Y2hVUkwiLCJzZXRGZXRjaFVSTCIsInVzZVN0YXRlIiwic2V0Vmlld0FjdGlvbnMiLCJ1c2VBY3Rpb25zIiwicm91dGVzIiwiYWRtaW4iLCJhcGkiLCJzZXJ2ZXJVUkwiLCJ1c2VDb25maWciLCJpMThuIiwidXNlVHJhbnNsYXRpb24iLCJsaW1pdCIsInBhZ2UiLCJzb3J0IiwidXNlU2VhcmNoUGFyYW1zIiwiQ3VzdG9tVmVyc2lvbnNWaWV3IiwiZG9jVVJMIiwiZW50aXR5TGFiZWwiLCJzbHVnIiwiZWRpdFVSTCIsImxhdGVzdERyYWZ0VmVyc2lvbiIsInNldExhdGVzdERyYWZ0VmVyc2lvbiIsInVuZGVmaW5lZCIsImxhdGVzdFB1Ymxpc2hlZFZlcnNpb24iLCJzZXRMYXRlc3RQdWJsaXNoZWRWZXJzaW9uIiwiZ2V0VHJhbnNsYXRpb24iLCJsYWJlbHMiLCJzaW5ndWxhciIsIkVkaXRDb2xsZWN0aW9uIiwiY29tcG9uZW50cyIsInZpZXdzIiwiRWRpdCIsIlZlcnNpb25zIiwiQ29tcG9uZW50IiwibGFiZWwiLCJFZGl0R2xvYmFsIiwiZGF0YSIsImlzTG9hZGluZyIsInVzZVBheWxvYWRBUEkiLCJpbml0aWFsUGFyYW1zIiwiZHJhZnQiLCJ2ZXJzaW9uc0RhdGEiLCJpc0xvYWRpbmdWZXJzaW9ucyIsInNldFBhcmFtcyIsInNoYXJlZFBhcmFtcyIsInN0YXR1cyIsImRlcHRoIiwid2hlcmUiLCJlcXVhbHMiLCJwdWJsaXNoZWQiLCJ1c2VFZmZlY3QiLCJmb3JtYXR0ZWRQdWJsaXNoZWQiLCJkb2NzIiwibGVuZ3RoIiwiZm9ybWF0dGVkRHJhZnQiLCJwdWJsaXNoZWROZXdlclRoYW5EcmFmdCIsInVwZGF0ZWRBdCIsImxhdGVzdCIsInBhcmFtcyIsImZldGNoVVJMVG9TZXQiLCJwYXJlbnQiLCJlZGl0Q29uZmlnIiwidmVyc2lvbnNBY3Rpb25zIiwiYWN0aW9ucyIsIkVkaXREZXB0aENvbnRleHQiLCJQcm92aWRlciIsInZhbHVlIiwiUmVuZGVyQ3VzdG9tQ29tcG9uZW50IiwiQ3VzdG9tQ29tcG9uZW50IiwiRGVmYXVsdENvbXBvbmVudCIsIkRlZmF1bHRWZXJzaW9uc1ZpZXciLCJjb21wb25lbnRQcm9wcyIsImNhbkFjY2Vzc0FkbWluIl0sInJhbmdlTWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsiLCJtYXBwaW5ncyI6Ijs7OzsrQkEyTUE7OztlQUFBOzs7K0RBM00yQzs4QkFDWjtnQ0FJQTtzRUFDTDtpQ0FDQztzQkFDSDt3QkFDRTsyQkFDTzs4RUFDQzs4QkFDRjt5QkFDSTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFcEMsTUFBTUEsZUFBcUMsQ0FBQ0M7SUFDMUMsTUFBTSxFQUFFQyxFQUFFLEVBQUVDLFVBQVUsRUFBRUMsTUFBTSxFQUFFLEdBQUdIO0lBRW5DLE1BQU0sRUFBRUksV0FBVyxFQUFFQyxJQUFJLEVBQUUsR0FBR0MsSUFBQUEsYUFBTztJ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